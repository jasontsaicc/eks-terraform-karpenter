# AWS EKS ç³»çµ±é‡å»ºå®Œæˆå ±å‘Š

## ğŸ“Š éƒ¨ç½²ç¸½çµ

âœ… **æˆåŠŸå®Œæˆå…¨æœå‹™é‡å»º**  
æ—¥æœŸï¼š2025-08-27  
å€åŸŸï¼šap-southeast-1  
é›†ç¾¤åç¨±ï¼šeks-lab-test-eks  

## ğŸ—ï¸ å·²éƒ¨ç½²åŸºç¤è¨­æ–½

### VPC å’Œç¶²è·¯
- **VPC CIDR**: 10.0.0.0/16
- **å…¬å…±å­ç¶²**: 10.0.1.0/24 (1a)
- **ç§æœ‰å­ç¶²**: 10.0.10.0/24 (1a), 10.0.11.0/24 (1b)
- **NAT Gateway**: 1å€‹ï¼ˆæˆæœ¬å„ªåŒ–é…ç½®ï¼‰
- **Internet Gateway**: å·²é…ç½®

### EKS é›†ç¾¤
- **Kubernetes ç‰ˆæœ¬**: v1.30.14-eks-3abbec1
- **ç¯€é»æ•¸é‡**: 2å€‹ï¼ˆt3.small å¯¦ä¾‹ï¼‰
- **ç¯€é»ç‹€æ…‹**: Ready
- **OIDC Provider**: å·²é…ç½®
- **IRSA**: å·²å•Ÿç”¨

## ğŸš€ å·²å®‰è£æœå‹™ç‹€æ…‹

### âœ… æ ¸å¿ƒç³»çµ±æœå‹™
| æœå‹™ | ç‹€æ…‹ | Podæ•¸é‡ | ç‰ˆæœ¬ |
|------|------|---------|------|
| CoreDNS | ğŸŸ¢ é‹è¡Œæ­£å¸¸ | 2/2 | é»˜èª |
| kube-proxy | ğŸŸ¢ é‹è¡Œæ­£å¸¸ | 2/2 | é»˜èª |
| aws-node (CNI) | ğŸŸ¢ é‹è¡Œæ­£å¸¸ | 2/2 | é»˜èª |

### âœ… æ“´å±•æœå‹™
| æœå‹™ | ç‹€æ…‹ | Podæ•¸é‡ | ç‰ˆæœ¬/é…ç½® |
|------|------|---------|-----------|
| AWS Load Balancer Controller | ğŸŸ¢ é‹è¡Œæ­£å¸¸ | 2/2 | æœ€æ–°ç‰ˆæœ¬ |
| Metrics Server | ğŸŸ¢ é‹è¡Œæ­£å¸¸ | 1/1 | æœ€æ–°ç‰ˆæœ¬ |
| EBS CSI Driver | ğŸŸ¢ é‹è¡Œæ­£å¸¸ | - | Terraform ç®¡ç† |

### ğŸŸ¡ éƒ¨åˆ†åŠŸèƒ½æœå‹™
| æœå‹™ | ç‹€æ…‹ | Podæ•¸é‡ | å•é¡Œèªªæ˜ |
|------|------|---------|----------|
| Karpenter | ğŸŸ¡ éƒ¨åˆ†æ•…éšœ | 1/6 æ­£å¸¸ | é…ç½®å•é¡Œå°è‡´å´©æ½°å¾ªç’° |

## ğŸ¯ åŠŸèƒ½é©—è­‰çµæœ

### âœ… å·²é©—è­‰åŠŸèƒ½

#### 1. AWS Load Balancer Controller
- **ç‹€æ…‹**: âœ… å®Œå…¨æ­£å¸¸
- **æ¸¬è©¦çµæœ**: 
  - æˆåŠŸå‰µå»º Network Load Balancer
  - LoadBalancer Service æ­£å¸¸å·¥ä½œ
  - å¤–éƒ¨ DNS åç¨±ï¼š`k8s-default-testngin-cb997603b9-e7b34c2541a5b79a.elb.ap-southeast-1.amazonaws.com`
  - è‡ªå‹•åˆ†é… NodePortï¼š31846

#### 2. åŸºæœ¬å®¹å™¨ç·¨æ’
- **ç‹€æ…‹**: âœ… æ­£å¸¸
- **æ¸¬è©¦çµæœ**: 
  - Pod éƒ¨ç½²æ­£å¸¸ï¼ˆ1å€‹ nginx pod é‹è¡Œä¸­ï¼‰
  - Service ç™¼ç¾æ­£å¸¸
  - å®¹å™¨ç¶²è·¯é€šä¿¡æ­£å¸¸

#### 3. è³‡æºç®¡ç†
- **ç‹€æ…‹**: âœ… æ­£å¸¸
- **æ¸¬è©¦çµæœ**: 
  - ç¯€é»è³‡æºåˆ†é…æ­£å¸¸
  - CPU/Memory é™åˆ¶æ­£å¸¸åŸ·è¡Œ
  - Pod èª¿åº¦æ©Ÿåˆ¶æ­£å¸¸

### ğŸŸ¡ éƒ¨åˆ†åŠŸèƒ½

#### 1. Karpenter è‡ªå‹•æ“´å±•
- **ç‹€æ…‹**: ğŸŸ¡ éœ€è¦ä¿®å¾©
- **å•é¡Œ**: 
  - CLUSTER_ENDPOINT é…ç½®å•é¡Œ
  - Pod é€²å…¥ CrashLoopBackOff ç‹€æ…‹
  - ç„¡æ³•è‡ªå‹•å‰µå»ºæ–°ç¯€é»
- **å½±éŸ¿**: 
  - éƒ¨åˆ† Pod è™•æ–¼ Pending ç‹€æ…‹ï¼ˆè³‡æºä¸è¶³ï¼‰
  - ç„¡æ³•é€²è¡Œè‡ªå‹•ç¸®æ”¾

## ğŸ“ å‰µå»ºçš„é‡è¦æ–‡ä»¶

### éƒ¨ç½²å’Œé…ç½®æ–‡ä»¶
- `terraform.tfvars.simple` - ç°¡åŒ–çš„ Terraform é…ç½®
- `quick-deploy.sh` - è‡ªå‹•åŒ–éƒ¨ç½²è…³æœ¬
- `gitlab-runner-values.yaml` - GitLab Runner Helm é…ç½®
- `karpenter-resources.yaml` - Karpenter NodePool é…ç½®
- `test-app.yaml` - æ¸¬è©¦æ‡‰ç”¨é…ç½®

### è…³æœ¬å’Œå·¥å…·
- `scripts/force-cleanup.sh` - å¼·åˆ¶æ¸…ç†è…³æœ¬
- `scripts/install-karpenter.sh` - Karpenter å®‰è£è…³æœ¬

### æ–‡æª”
- `EKS-DEPLOYMENT-GUIDE.md` - å®Œæ•´éƒ¨ç½²æŒ‡å—ï¼ˆ490è¡Œï¼‰
- `SYSTEM-STATUS-REPORT.md` - æœ¬å ±å‘Š

## ğŸ”§ ç•¶å‰å·²çŸ¥å•é¡Œ

### 1. Karpenter é…ç½®å•é¡Œ
```
éŒ¯èª¤: panic: "" not a valid CLUSTER_ENDPOINT URL; CLUSTER_NAME is required
è§£æ±ºæ–¹æ¡ˆ: éœ€è¦æ­£ç¢ºé…ç½® ConfigMap ä¸­çš„é›†ç¾¤ç«¯é»
å„ªå…ˆç´š: é«˜
```

### 2. ç¯€é»è³‡æºä¸è¶³
```
ç¾è±¡: éƒ¨åˆ† Pod è™•æ–¼ Pending ç‹€æ…‹
åŸå› : åƒ…æœ‰ 2å€‹ t3.small ç¯€é»ï¼Œè³‡æºæœ‰é™
è§£æ±ºæ–¹æ¡ˆ: ä¿®å¾© Karpenter æˆ–æ‰‹å‹•æ·»åŠ ç¯€é»
å„ªå…ˆç´š: ä¸­
```

## ğŸ’° æˆæœ¬å„ªåŒ–åŠŸèƒ½

### å·²å•Ÿç”¨çš„æˆæœ¬æ§åˆ¶
- âœ… å–®ä¸€ NAT Gatewayï¼ˆè€Œéæ¯å€‹ AZ ä¸€å€‹ï¼‰
- âœ… t3.small ç¯€é»é¡å‹ï¼ˆä½æˆæœ¬å¯¦ä¾‹ï¼‰
- âœ… On-Demand ç¯€é»ï¼ˆå¯é æ€§å„ªå…ˆï¼‰
- âœ… Spot å¯¦ä¾‹æ”¯æ´ï¼ˆKarpenter é…ç½®ä¸­ï¼‰

### é ä¼°æˆæœ¬ï¼ˆæ¯æœˆï¼‰
- EKS é›†ç¾¤ï¼š$72.00
- 2å€‹ t3.small ç¯€é»ï¼š~$30.00
- NAT Gatewayï¼š~$32.00
- å…¶ä»–è³‡æºï¼š~$20.00
- **ç¸½è¨ˆç´„ï¼š$154.00/æœˆ**

## ğŸ¯ å¾ŒçºŒå»ºè­°æ“ä½œ

### ç«‹å³éœ€è¦çš„ä¿®å¾©
1. **ä¿®å¾© Karpenter é…ç½®**
   ```bash
   # æª¢æŸ¥ä¸¦æ›´æ–° ConfigMap
   kubectl get configmap karpenter-global-settings -n karpenter -o yaml
   # é‡æ–°éƒ¨ç½² Karpenter è³‡æº
   kubectl apply -f karpenter-resources.yaml
   ```

2. **GitLab Runner éƒ¨ç½²**ï¼ˆå¦‚éœ€è¦ï¼‰
   ```bash
   # ç·¨è¼¯é…ç½®æ–‡ä»¶æ·»åŠ è¨»å†Šä»¤ç‰Œ
   vi gitlab-runner-values.yaml
   # éƒ¨ç½² GitLab Runner
   helm install gitlab-runner gitlab/gitlab-runner -f gitlab-runner-values.yaml
   ```

### å¯é¸çš„æ”¹é€²
1. **ç›£æ§å’Œæ—¥èªŒ**
   - éƒ¨ç½² Prometheus + Grafana
   - é…ç½® CloudWatch Logs é›†æˆ

2. **å®‰å…¨åŠ å›º**
   - é…ç½® Network Policies
   - å•Ÿç”¨ Pod Security Standards

3. **é«˜å¯ç”¨æ€§**
   - å¤š AZ ç¯€é»åˆ†ä½ˆ
   - æ•¸æ“šåº«é«˜å¯ç”¨é…ç½®

## ğŸ“ ä½¿ç”¨æŒ‡å—

### å¿«é€Ÿé–‹å§‹å‘½ä»¤
```bash
# è¨­ç½® kubectl é…ç½®
export KUBECONFIG=~/.kube/config-eks

# æª¢æŸ¥é›†ç¾¤ç‹€æ…‹
kubectl get nodes
kubectl get pods -A

# éƒ¨ç½²æ¸¬è©¦æ‡‰ç”¨
kubectl apply -f test-app.yaml

# æª¢æŸ¥æœå‹™
kubectl get svc
```

### æ¸…ç†è³‡æº
```bash
# æ¨™æº–æ¸…ç†
terraform destroy -auto-approve

# å¼·åˆ¶æ¸…ç†ï¼ˆå¦‚æœ Terraform å¤±æ•—ï¼‰
./scripts/force-cleanup.sh
```

## ğŸ“‹ ç¸½çµ

**ğŸ‰ é‡å»ºæˆåŠŸ**: EKS é›†ç¾¤åŠå¤§éƒ¨åˆ†æœå‹™å·²æˆåŠŸéƒ¨ç½²ä¸¦é‹è¡Œæ­£å¸¸

**âœ… æ ¸å¿ƒåŠŸèƒ½**: æ‰€æœ‰åŸºç¤ Kubernetes åŠŸèƒ½æ­£å¸¸ï¼ŒåŒ…æ‹¬è² è¼‰å‡è¡¡ã€æœå‹™ç™¼ç¾ã€å®¹å™¨ç·¨æ’

**ğŸŸ¡ å¾…ä¿®å¾©**: Karpenter è‡ªå‹•æ“´å±•åŠŸèƒ½éœ€è¦é€²ä¸€æ­¥é…ç½®èª¿æ•´

**ğŸ“š æ–‡æª”å®Œæ•´**: æä¾›äº†å®Œæ•´çš„æ“ä½œæ‰‹å†Šå’Œæ•…éšœæ’é™¤æŒ‡å—

**ğŸ’¡ å»ºè­°**: ç³»çµ±å·²å¯ç”¨æ–¼é–‹ç™¼å’Œæ¸¬è©¦å·¥ä½œè² è¼‰ï¼Œç”Ÿç”¢ä½¿ç”¨å‰å»ºè­°å…ˆä¿®å¾© Karpenter å•é¡Œ

---
*å ±å‘Šç”Ÿæˆæ™‚é–“ï¼š2025-08-27*  
*ç³»çµ±ç‹€æ…‹ï¼šåŸºæœ¬é‹è¡Œæ­£å¸¸ï¼Œéƒ¨åˆ†åŠŸèƒ½éœ€è¦èª¿æ•´*